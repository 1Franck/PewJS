/*! build 2014-08-31 19:08:53 */
/*! Pew.js */
/*! Copyright Francois Lajoie */
/*! MIT License */
"use strict";var Pew=function(){function a(a){var b={title:"My Project",fps:60,resources:[],vars:{}};return this.conf=Pew.utils.extend({},b,a),this.scenes={},this.layers={},this.animationFrame=new AnimationFrame(this.conf.fps),this}function b(a){var b=a||{};return this.full=b.full||!0,this.autoresize=b.autoresize||!0,this.width=b.width||"480",this.height=b.height||"320",this.canvas=b.canvas||null,this.ctx=b.ctx||null,this.init(),this}function c(a,b){return this.fn=b||function(){},function(){this._name=a,this._fid=0,this._status="idle",this.is=function(a){return this._status===a?!0:!1},this.requestAnim=function(a){var a=a||this.draw;this._fid=Pew.project().animationFrame.request(a),this._status="playing"},this.cancelAnim=function(){Pew.project().animationFrame.cancel(this._fid),this._status="idle"},this.toggleAnim=function(a){if(this.is("idle")){var a=a||this.draw;a()}else this.cancelAnim()}}.apply(this.fn),this}{var d;!function(){var a=1e3;return{get:function(){return++a}}}()}return{Project:a,Scene:c,Layer:b,project:function(){return d},createProject:function(b){return d=new a(b)}}}();Pew.Project.prototype.createLayer=function(a,b){var c=new Pew.Layer(b);return this.layers[a]=c,c},Pew.Project.prototype.start=function(a){var b=this.scenes[a].fn;b.init&&b.init(),b.draw()},Pew.Project.prototype.createScene=function(a,b){return this.scenes[a]=new Pew.Scene(a,b),this.scenes[a]},Pew.Layer.prototype.init=function(){if(null==this.canvas&&(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),document.body.appendChild(this.canvas)),this.canvas.style.display="block",this.canvas.style.position="absolute",this.canvas.style.zIndex=this._zi.get(),this.full?this.fullscreen():(this.canvas.width=this.width,this.canvas.height=this.height),this.autoresize){window.onresize=window.onresize||function(){for(var a in Pew.project().layers)Pew.project().layers[a].autoresize&&Pew.project().layers[a].fullscreen()}}},Pew.Layer.prototype.fullscreen=function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.width=this.canvas.width,this.height=this.canvas.height},Pew.Layer.prototype.clear=function(a,b,c,d){var a=a||0,b=b||0,c=c||this.canvas.width,d=d||this.canvas.height;this.ctx.clearRect(a,b,c,d)},Pew.Layer.prototype._zi=function(){var a=0;return{get:function(){return++a}}}(),Pew.utils=function(){},Pew.utils.deepExtend=function(a){a=a||{};for(var b=1;b<arguments.length;b++){var c=arguments[b];if(c)for(var d in c)c.hasOwnProperty(d)&&("object"==typeof c[d]?Pew.utils.extend(a[d],c[d]):a[d]=c[d])}return a},Pew.utils.extend=function(a){a=a||{};for(var b=1;b<arguments.length;b++){var c=arguments[b];if(c)for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a},Pew.utils.rand=function(a,b,c){return void 0===c&&(c=1),Math.round((Math.floor(Math.random()*(b-a+1))+a)/c)*c},Pew.utils.randIndex=function(a){return a[this.rand(1,a.length)-1]},Pew.utils.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f},Pew.Project.prototype.mouse=function(){function a(a){for(var b=a.offsetLeft,c=a.offsetTop,d=a.offsetParent;null!==d;)b=parseInt(b)+parseInt(d.offsetLeft),c=parseInt(c)+parseInt(d.offsetTop),d=d.offsetParent;return new Array(b,c)}function b(b){var b=b||null;null!=b&&(b.addEventListener("click",function(){c.click=!0,d.click&&d.click(),c.click=!1}),b.addEventListener("dblclick",function(){c.dblclick=!0,d.dblclick&&d.dblclick(),c.dblclick=!1}),b.addEventListener("mousemove",function(c){var d=a(b);e.x=c.clientX-d[0],e.y=c.clientY-d[1]}))}var c=[],d=[],e={x:0,y:0};return{init:b,cursor:e,x:function(a){return e.x=a||e.x,e.x},y:function(a){return e.y=a||e.y,e.y},on:function(a,b){d[a]=b},off:function(a){d.splice(a,1)}}}(),Pew.Project.prototype.keyboard=function(){function a(){document.body.addEventListener("keydown",function(a){e[a.keyCode]=!0,f[a.keyCode]&&(b(a.keyCode),a.preventDefault())}),document.body.addEventListener("keyup",function(a){e[a.keyCode]=!1})}function b(a){var b=c(a);f[b]&&f[b]({"char":d(b).toLowerCase(),code:b})}function c(a){if(isNaN(a)){var a=g[a.toUpperCase()]||a;isNaN(a)&&(a=a.toUpperCase().charCodeAt(0))}return a}function d(a){if(isNaN(a))return a;for(var b in g)if(g[b]==a)return b;return String.fromCharCode(a)}for(var e=[],f={},g={SHIFT:16,TAB:9,CTRL:17,ALT:18,SPACE:32,BACKSPACE:8,ENTER:13,ESC:27,LEFT:37,RIGHT:39,UP:38,DOWN:40},h=1;13>h;++h)g["F"+h]=111+h;return{init:a,toKeyCode:c,toKeyChar:d,trigger:b,key:function(a){return a=c(a),void 0===e[a]&&(e[a]=!1),e[a]},keys:function(){var a=[];for(var b in e)0!=e[b]&&a.push(b);return a},on:function(a,b){if("[object Array]"===Object.prototype.toString.call(a))for(var d in a)f[c(a[d])]=b;else f[c(a)]=b},off:function(a){if(void 0!==a)if("[object Array]"===Object.prototype.toString.call(a))for(var b in a)delete f[c(a[b])];else delete f[c(a)];else for(var a in f)delete f[a]}}}(),Pew.Project.prototype.resources=function(){function a(a,b){this.url=a,this.rid=b,this.ready=!1,this.el=!1;var c=a.split(".");this.ext=1===c.length||""===c[0]&&2===c.length?"":c.pop()}function b(b,c,d){c=c||function(){},d=d||function(){},g.push(c);var h=g.length-1;b instanceof Array&&(d(e(h)),b.forEach(function(b){var e=new a(b,h);if("image"===e.type())e.el=new Image;else{if("audio"!==e.type())return;e.el=new Audio}e.onLoad(c,d),e.el.src=b,f[b]=e}))}function c(a){return f[a].el}function d(a){var b=!0;for(var c in f)f[c].ready===!1&&f[c].rid===a&&(b=!1);return b}function e(a){var b=0,c=0;for(var d in f)f[d].rid===a&&(f[d].ready===!1?++c:++b);return{total:b+c,ready:b,not_ready:c,progress:Math.round(100*b/(b+c))||0}}var f={},g=[],h={audio:["mp3","m4a","ogg","oga","webma","wav"],image:["jpg","jpeg","png","gif"]};return a.prototype.type=function(){for(property in h)for(var a in h[property])if(h[property][a]===this.ext)return property},a.prototype.onLoad=function(a,b){var c=this;this.el.addEventListener("load",function(){c.ready=!0;var f=e(c.rid);d(c.rid)?(b(f),a(),g[c.rid]=function(){}):b(f)})},{load:b,get:c}}(),Pew.Project.prototype.fpsmeter=function(){function a(a){a||(a={}),this.updateRate=a.updateRate||1e3,this._tickCounter=0,this._updateTimeoutId=null,this.current=0}var b=Date.now||function(){return(new Date).getTime()};return a.prototype.start=function(a){var c=this;return a=a||function(){},this._startTime=b(),this._tickCounter=0,this._updateTimeoutId=setTimeout(function(){c._tickCounter&&(c.current=Math.round(1e3/((b()-c._startTime)/c._tickCounter)),a(c.current)),c.start(a)},this.updateRate),this},a.prototype.stop=function(){return clearTimeout(this._updateTimeoutId),this},a.prototype.tick=function(){return++this._tickCounter,this},new a}(),function(a){function b(a){return this instanceof b?(a||(a={}),"number"==typeof a&&(a={frameRate:a}),null!=a.useNative||(a.useNative=!0),this.options=a,this.frameRate=a.frameRate||b.FRAME_RATE,this._frameLength=1e3/this.frameRate,this._isCustomFrameRate=this.frameRate!==b.FRAME_RATE,this._timeoutId=null,this._callbacks={},this._lastTickTime=0,void(this._tickCounter=0)):new b(a)}var c,d;!function(){var e,f,g=["webkit","moz","ms","o"];try{a.top.name,f=a.top}catch(h){f=a}for(c=f.requestAnimationFrame,d=f.cancelAnimationFrame||f.cancelRequestAnimationFrame,e=0;e<g.length&&!c;e++)c=f[g[e]+"RequestAnimationFrame"],d=f[g[e]+"CancelAnimationFrame"]||f[g[e]+"CancelRequestAnimationFrame"];c&&c(function(){b.hasNative=!0})}(),b.FRAME_RATE=60,b.shim=function(c){var d=new b(c);return a.requestAnimationFrame=function(a){return d.request(a)},a.cancelAnimationFrame=function(a){return d.cancel(a)},d},b.now=Date.now||function(){return(new Date).getTime()},b.navigationStart=b.now(),b.perfNow=function(){return a.performance&&a.performance.now?a.performance.now():b.now()-b.navigationStart},b.hasNative=!1,b.prototype.request=function(d){var e,f=this;if(++this._tickCounter,b.hasNative&&f.options.useNative&&!this._isCustomFrameRate)return c(d);if(!d)throw new TypeError("Not enough arguments");return null==this._timeoutId&&(e=this._frameLength+this._lastTickTime-b.now(),0>e&&(e=0),this._timeoutId=a.setTimeout(function(){var a;f._lastTickTime=b.now(),f._timeoutId=null,++f._tickCounter;for(a in f._callbacks)f._callbacks[a]&&(b.hasNative&&f.options.useNative?c(f._callbacks[a]):f._callbacks[a](b.perfNow()),delete f._callbacks[a])},e)),this._callbacks[this._tickCounter]=d,this._tickCounter},b.prototype.cancel=function(a){b.hasNative&&this.options.useNative&&d(a),delete this._callbacks[a]},"object"==typeof exports&&"object"==typeof module?module.exports=b:"function"==typeof define&&define.amd?define(function(){return b}):a.AnimationFrame=b}(window);